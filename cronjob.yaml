---
# cronjob.yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: one
spec:
  schedule: "*/5 * * * *"
  suspend: true
  successfulJobsHistoryLimit: 5
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            env:
            - name: FOOBAR
              value: "foobar"
            args:
            - /bin/sh
            - -c
            - date; for i in $(seq 1 25); do echo "Hello, $FOOBAR $i"; sleep 3; done
          restartPolicy: Never
---
# cronjob.yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: two
  annotations:
    kubernetes-job-runner.io/config: |
      {
        "description": "A job to deploy the current k8s-manifests configuration of the specified helm chart",
        "options": [
          {
            "envVar": "LIST",
            "type": "list",
            "values": [
              "FOO",
              "BAR",
              "foobar"
            ],
            "default": "foobar",
            "description": "An option to select what type of foo",
            "container": "hello"
          },
          {
            "envVar": "INT",
            "default": "1",
            "type": "int",
            "descriptions": "int to deploy",
            "container": "goodbye"
          },
          {
            "envVar": "FLOAT",
            "default": "1.1",
            "type": "float",
            "descriptions": "float to deploy",
            "container": "goodbye"
          },
          {
            "envVar": "REGEX",
            "default": "",
            "type": "regex",
            "regex": "^int-.*",
            "descriptions": "regex to deploy",
            "container": "goodbye"
          },
          {
            "envVar": "TEXTAREA",
            "default": "",
            "type": "textarea",
            "descriptions": "freeform text",
            "container": "goodbye"
          },
          {
            "envVar": "BOOL",
            "type": "bool",
            "values": [
              "true",
              "false"
            ],
            "default": "true",
            "description": "Should we do something?",
            "container": "hello"
          }
        ]
      }
spec:
  schedule: "0,15,30,45 * * * *"
  successfulJobsHistoryLimit: 10
  failedJobsHistoryLimit: 10
  jobTemplate:
    spec:
      parallelism: 1
      completions: 1
      backoffLimit: 1
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo "container hello $FOOBAR"; if [ $RANDOM -gt 25766 ]; then echo "failing"; exit 1; fi
            env:
              - name: FOOBAR
                value: "FOOBAR not set"
          - name: goodbye
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo "container goodbye $BARFOO"; if [ $RANDOM -gt 25766 ]; then echo "failing"; exit 1; fi
            env:
              - name: BARFOO
                value: "BARFOO not set"
          restartPolicy: Never
