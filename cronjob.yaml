---
# cronjob.yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: one
spec:
  schedule: "*/5 * * * *"
  suspend: true
  successfulJobsHistoryLimit: 5
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            env:
            - name: FOOBAR
              value: "foobar"
            args:
            - /bin/sh
            - -c
            - date; for i in $(seq 1 10); do echo "Hello, $FOOBAR $i"; sleep 3; done
          restartPolicy: Never
---
# cronjob.yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: two
  annotations:
    kubernetes-job-runner.io/config: |
      {
        "description": "A job to deploy the current k8s-manifests configuration of the specified helm chart",
        "options": [
          {
            "envvar": "BARFOO",
            "default": "some value",
            "type": "string",
            "descriptions": "Helm chart to deploy",
            "container": "goodbye"
          },
          {
            "envvar": "FOOBAR",
            "type": "list",
            "values": [
              "FOO",
              "BAR",
              "foobar"
            ],
            "default": "foobar",
            "description": "An option to select what type of foo",
            "container": "hello"
          },
          {
            "envvar": "VERY_LONG_BOOLEAN_VALUE",
            "type": "list",
            "values": [
              "true",
              "false"
            ],
            "default": "true",
            "description": "Should we do something?",
            "container": "hello"
          }
        ]
      }
spec:
  schedule: "*/2 * * * *"
  successfulJobsHistoryLimit: 5
  failedJobsHistoryLimit: 5
  jobTemplate:
    spec:
      backoffLimit: 1
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo "$FOOBAR"; if [ $RANDOM -gt 5766 ]; then echo "failing"; exit 1; fi
            env:
              - name: FOOBAR
                value: "FOOBAR not set"
          - name: goodbye
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo "$BARFOO"; if [ $RANDOM -gt 5766 ]; then echo "failing"; exit 1; fi
            env:
              - name: BARFOO
                value: "BARFOO not set"
          restartPolicy: Never
